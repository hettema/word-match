<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Match - Responsive Test</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        .debug-panel {
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            font-family: monospace;
            z-index: 1000;
            font-size: 10px;
            max-width: 100%;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="debug-panel" id="debugPanel">Loading...</div>
    
    <div class="game-wrapper">
        <div id="game-container">
            <div class="ui-layer">
                <div class="score-panel">
                    <div class="score-label">SCORE</div>
                    <div class="score-value" id="score">42</div>
                    
                    <div class="target-info">
                        <div class="target-label" id="targetLabel">TARGET: 350</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="moves-panel">
                    <div class="moves-value" id="movesRemaining">13</div>
                    <div class="score-label">MOVES</div>
                </div>
            </div>
            
            <div class="grid-container">
                <div id="game-board-area" class="game-board-area">
                    <!-- Phaser canvas will be inserted here -->
                </div>
            </div>
            
            <div class="current-word" id="currentWord"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <script src="../src/core/Tile.js"></script>
    <script src="../src/core/Grid.js"></script>
    <script>
        // Simple debug panel
        function updateDebugInfo() {
            const panel = document.getElementById('debugPanel');
            const info = {
                'Screen Size': `${window.innerWidth}x${window.innerHeight}`,
                'Device Pixel Ratio': window.devicePixelRatio,
                'Canvas Size': game ? `${game.canvas.width}x${game.canvas.height}` : 'N/A',
                'Canvas Style': game ? `${game.canvas.style.width}x${game.canvas.style.height}` : 'N/A',
                'Tile Size': grid ? grid.tileSize : 'N/A',
                'Grid Padding': grid ? grid.gridPadding : 'N/A',
            };
            
            panel.innerHTML = Object.entries(info)
                .map(([key, value]) => `<div>${key}: <strong>${value}</strong></div>`)
                .join('');
        }

        // Global tile types for testing
        window.TILE_TYPES = {
            NORMAL: 'normal',
            MULTIPLIER: 'multiplier',
            BOMB: 'bomb',
            ICE: 'ice',
            HIDDEN: 'hidden'
        };

        window.TILE_STATES = {
            IDLE: 'idle',
            SELECTED: 'selected',
            MATCHING: 'matching',
            EXPLODING: 'exploding'
        };

        // Mock data for the game
        const mockConfig = {
            gridSize: { width: 6, height: 6 },
            specialTiles: { MULTIPLIER: 0.1, BOMB: 0.05, ICE: 0.05, HIDDEN: 0.05 },
            tileDistribution: 'standard',
            tileDistributionData: {
                'A': { count: 9, value: 1 },
                'B': { count: 2, value: 3 },
                'C': { count: 2, value: 3 },
                'D': { count: 4, value: 2 },
                'E': { count: 12, value: 1 },
                'F': { count: 2, value: 4 },
                'G': { count: 3, value: 2 },
                'H': { count: 2, value: 4 },
                'I': { count: 9, value: 1 },
                'J': { count: 1, value: 8 },
                'K': { count: 1, value: 5 },
                'L': { count: 4, value: 1 },
                'M': { count: 2, value: 3 },
                'N': { count: 6, value: 1 },
                'O': { count: 8, value: 1 },
                'P': { count: 2, value: 3 },
                'Q': { count: 1, value: 10 },
                'R': { count: 6, value: 1 },
                'S': { count: 4, value: 1 },
                'T': { count: 6, value: 1 },
                'U': { count: 4, value: 1 },
                'V': { count: 2, value: 4 },
                'W': { count: 2, value: 4 },
                'X': { count: 1, value: 8 },
                'Y': { count: 2, value: 4 },
                'Z': { count: 1, value: 10 }
            }
        };

        const mockSettings = {
            display: {
                tileSize: 64,
                gridPadding: 6
            }
        };

        let game;
        let grid;

        // Simple Phaser scene for testing responsiveness
        class TestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'TestScene' });
            }

            preload() {
                // No assets needed
            }

            create() {
                // Create the board background
                this.createGameBoard();
                
                // Store board dimensions in registry for Grid
                this.registry.set('boardDimensions', this.boardDimensions);
                this.registry.set('settings', mockSettings);
                
                // Create the grid
                grid = new Grid(this, mockConfig);
                
                // Update debug panel
                updateDebugInfo();

                // Set up resize handler
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    if (resizeTimeout) clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        this.handleResize();
                        updateDebugInfo();
                    }, 250);
                });
            }

            createGameBoard() {
                const canvasWidth = this.scale.width;
                const canvasHeight = this.scale.height;
                
                const margin = 20;
                const size = Math.min(canvasWidth, canvasHeight) - (margin * 2);
                const cornerRadius = 15;
                
                const startX = (canvasWidth - size) / 2;
                const startY = (canvasHeight - size) / 2;
                
                this.boardDimensions = {
                    x: startX,
                    y: startY,
                    size: size,
                    margin: margin,
                    cornerRadius: cornerRadius
                };
                
                if (this.boardBg) this.boardBg.clear();
                
                this.boardBg = this.add.graphics();
                this.boardBg.fillStyle(0x34495e, 1);
                this.boardBg.fillRoundedRect(startX, startY, size, size, cornerRadius);
                
                console.log('Created game board with dimensions:', this.boardDimensions);
            }

            handleResize() {
                // Recreate the game board
                this.createGameBoard();
                
                // Update the registry with new dimensions
                this.registry.set('boardDimensions', this.boardDimensions);
                
                // Update grid layout
                if (grid) {
                    grid.updateLayout();
                }
                
                console.log('Handled resize, new dimensions:', this.scale.width, this.scale.height);
            }
        }

        // Initialize game
        function initGame() {
            const gameConfig = {
                type: Phaser.AUTO,
                width: 450,
                height: 500,
                backgroundColor: 0x34495e,
                parent: 'game-board-area',
                scale: {
                    mode: Phaser.Scale.FIT,
                    autoCenter: Phaser.Scale.CENTER_BOTH,
                    width: 450,
                    height: 500
                },
                scene: TestScene
            };

            game = new Phaser.Game(gameConfig);
        }

        // Start the game when page loads
        window.onload = function() {
            initGame();
            updateDebugInfo();
        };
    </script>
</body>
</html>